---
import Base from '../layouts/Base.astro';
import Subscribe from '../components/Subscribe.astro';
import { getPosts, getPost } from '../lib/ghost';

export async function getStaticPaths() {
    const posts = await getPosts();
    return posts.map((post) => ({
        params: { slug: post.slug },
    }));
}

const { slug } = Astro.params;
const post = await getPost(slug);

const formatDate = (dateString: string) => {
    const date = new Date(dateString);
    return date.toLocaleDateString('en-GB', {
        day: 'numeric',
        month: 'long',
        year: 'numeric'
    });
};
---

<Base title={`${post.title} - Macon Phillips`} description={post.excerpt}>
    <article class="letter">
        <header class="letter-header">
            <time class="letter-date" datetime={post.published_at}>
                {formatDate(post.published_at)}
            </time>
            <h1 class="letter-title">{post.title}</h1>
        </header>

        <div class="letter-content" set:html={post.html} />
    </article>

    <Subscribe />
</Base>
